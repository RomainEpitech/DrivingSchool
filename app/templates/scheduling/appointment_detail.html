
{% extends 'base.html' %}

{% block title %}Détail du Rendez-vous - My Driving School{% endblock %}

{% block content %}
<div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6 bg-gradient-to-r from-primary-700 to-primary-800 text-white">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h3 class="text-2xl leading-6 font-medium font-heading">
                    Détail du Rendez-vous
                </h3>
                <p class="mt-1 max-w-2xl text-sm text-primary-100">
                    Informations complètes sur ce rendez-vous.
                </p>
            </div>
            <div class="mt-4 md:mt-0">
                {% if appointment.date >= today_date %}
                    {% if user.user_type in 'instructor,secretary,admin' %}
                    <a href="{% url 'appointment_edit' appointment.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-primary-700 bg-white hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white">
                        <i class="fas fa-edit mr-2"></i>
                        Modifier
                    </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="border-t border-gray-200">
        <dl>
            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Date
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.date|date:"d/m/Y" }}
                </dd>
            </div>
            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Horaire
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.start_time }} - {{ appointment.end_time }} ({{ appointment.duration }} heure{% if appointment.duration > 1 %}s{% endif %})
                </dd>
            </div>
            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Élève
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.student.user.first_name }} {{ appointment.student.user.last_name }}
                    {% if user.user_type in 'secretary,admin,instructor' %}
                    <a href="{% url 'student_detail' appointment.student.pk %}" class="ml-2 text-primary-600 hover:text-primary-800">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    {% endif %}
                </dd>
            </div>
            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Instructeur
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.instructor.user.first_name }} {{ appointment.instructor.user.last_name }}
                    {% if user.user_type in 'secretary,admin' %}
                    <a href="{% url 'instructor_detail' appointment.instructor.pk %}" class="ml-2 text-primary-600 hover:text-primary-800">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    {% endif %}
                </dd>
            </div>
            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Lieu
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.location }}
                </dd>
            </div>
            {% if appointment.notes %}
            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Notes
                </dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                    {{ appointment.notes }}
                </dd>
            </div>
            {% endif %}
            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">
                    Statut
                </dt>
                <dd class="mt-1 text-sm sm:mt-0 sm:col-span-2">
                    {% if appointment.date < today_date %}
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                        Passé
                    </span>
                    {% elif appointment.date == today_date %}
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Aujourd'hui
                    </span>
                    {% else %}
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        À venir
                    </span>
                    {% endif %}
                </dd>
            </div>
        </dl>
    </div>
    
    <div class="px-4 py-5 sm:px-6 border-t border-gray-200">
        <div class="flex flex-wrap gap-3 justify-between">
            <div>
                <a href="{% url 'appointment_list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Retour aux rendez-vous
                </a>
            </div>
            
            {% if appointment.date >= today_date %}
            <div>
                {% if user.user_type in 'instructor,secretary,admin' %}
                <a href="{% url 'appointment_edit' appointment.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-edit mr-2"></i>
                    Modifier
                </a>
                <a href="{% url 'appointment_delete' appointment.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <i class="fas fa-trash mr-2"></i>
                    Supprimer
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
```